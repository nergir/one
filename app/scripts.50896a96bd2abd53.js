!function(M,w){"object"==typeof exports&&"object"==typeof module?module.exports=w():"function"==typeof define&&define.amd?define([],w):"object"==typeof exports?exports.Pusher=w():M.Pusher=w()}(window,function(){return function(M){var w={};function k(d){if(w[d])return w[d].exports;var S=w[d]={i:d,l:!1,exports:{}};return M[d].call(S.exports,S,S.exports,k),S.l=!0,S.exports}return k.m=M,k.c=w,k.d=function(d,S,m){k.o(d,S)||Object.defineProperty(d,S,{enumerable:!0,get:m})},k.r=function(d){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},k.t=function(d,S){if(1&S&&(d=k(d)),8&S||4&S&&"object"==typeof d&&d&&d.__esModule)return d;var m=Object.create(null);if(k.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:d}),2&S&&"string"!=typeof d)for(var l in d)k.d(m,l,function(b){return d[b]}.bind(null,l));return m},k.n=function(d){var S=d&&d.__esModule?function(){return d.default}:function(){return d};return k.d(S,"a",S),S},k.o=function(d,S){return Object.prototype.hasOwnProperty.call(d,S)},k.p="",k(k.s=2)}([function(M,w,k){"use strict";var d,S=this&&this.__extends||(d=function(h,a){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,f){u.__proto__=f}||function(u,f){for(var C in f)f.hasOwnProperty(C)&&(u[C]=f[C])})(h,a)},function(h,a){function u(){this.constructor=h}d(h,a),h.prototype=null===a?Object.create(a):(u.prototype=a.prototype,new u)});Object.defineProperty(w,"__esModule",{value:!0});var m=function(){function h(a){void 0===a&&(a="="),this._paddingCharacter=a}return h.prototype.encodedLength=function(a){return this._paddingCharacter?(a+2)/3*4|0:(8*a+5)/6|0},h.prototype.encode=function(a){for(var u="",f=0;f<a.length-2;f+=3){var C=a[f]<<16|a[f+1]<<8|a[f+2];u+=this._encodeByte(C>>>18&63),u+=this._encodeByte(C>>>12&63),u+=this._encodeByte(C>>>6&63),u+=this._encodeByte(C>>>0&63)}var A=a.length-f;return A>0&&(u+=this._encodeByte((C=a[f]<<16|(2===A?a[f+1]<<8:0))>>>18&63),u+=this._encodeByte(C>>>12&63),u+=2===A?this._encodeByte(C>>>6&63):this._paddingCharacter||"",u+=this._paddingCharacter||""),u},h.prototype.maxDecodedLength=function(a){return this._paddingCharacter?a/4*3|0:(6*a+7)/8|0},h.prototype.decodedLength=function(a){return this.maxDecodedLength(a.length-this._getPaddingLength(a))},h.prototype.decode=function(a){if(0===a.length)return new Uint8Array(0);for(var u=this._getPaddingLength(a),f=a.length-u,C=new Uint8Array(this.maxDecodedLength(f)),A=0,E=0,R=0,H=0,D=0,j=0,I=0;E<f-4;E+=4)H=this._decodeChar(a.charCodeAt(E+0)),D=this._decodeChar(a.charCodeAt(E+1)),j=this._decodeChar(a.charCodeAt(E+2)),I=this._decodeChar(a.charCodeAt(E+3)),C[A++]=H<<2|D>>>4,C[A++]=D<<4|j>>>2,C[A++]=j<<6|I,R|=256&H,R|=256&D,R|=256&j,R|=256&I;if(E<f-1&&(H=this._decodeChar(a.charCodeAt(E)),D=this._decodeChar(a.charCodeAt(E+1)),C[A++]=H<<2|D>>>4,R|=256&H,R|=256&D),E<f-2&&(j=this._decodeChar(a.charCodeAt(E+2)),C[A++]=D<<4|j>>>2,R|=256&j),E<f-3&&(I=this._decodeChar(a.charCodeAt(E+3)),C[A++]=j<<6|I,R|=256&I),0!==R)throw new Error("Base64Coder: incorrect characters for decoding");return C},h.prototype._encodeByte=function(a){var u=a;return u+=65,u+=25-a>>>8&6,u+=51-a>>>8&-75,u+=61-a>>>8&-15,u+=62-a>>>8&3,String.fromCharCode(u)},h.prototype._decodeChar=function(a){var u=256;return u+=(42-a&a-44)>>>8&-256+a-43+62,u+=(46-a&a-48)>>>8&-256+a-47+63,u+=(47-a&a-58)>>>8&-256+a-48+52,(u+=(64-a&a-91)>>>8&-256+a-65+0)+((96-a&a-123)>>>8&-256+a-97+26)},h.prototype._getPaddingLength=function(a){var u=0;if(this._paddingCharacter){for(var f=a.length-1;f>=0&&a[f]===this._paddingCharacter;f--)u++;if(a.length<4||u>2)throw new Error("Base64Coder: incorrect padding")}return u},h}();w.Coder=m;var l=new m;w.encode=function(h){return l.encode(h)},w.decode=function(h){return l.decode(h)};var b=function(h){function a(){return null!==h&&h.apply(this,arguments)||this}return S(a,h),a.prototype._encodeByte=function(u){var f=u;return f+=65,f+=25-u>>>8&6,f+=51-u>>>8&-75,f+=61-u>>>8&-13,f+=62-u>>>8&49,String.fromCharCode(f)},a.prototype._decodeChar=function(u){var f=256;return f+=(44-u&u-46)>>>8&-256+u-45+62,f+=(94-u&u-96)>>>8&-256+u-95+63,f+=(47-u&u-58)>>>8&-256+u-48+52,(f+=(64-u&u-91)>>>8&-256+u-65+0)+((96-u&u-123)>>>8&-256+u-97+26)},a}(m);w.URLSafeCoder=b;var g=new b;w.encodeURLSafe=function(h){return g.encode(h)},w.decodeURLSafe=function(h){return g.decode(h)},w.encodedLength=function(h){return l.encodedLength(h)},w.maxDecodedLength=function(h){return l.maxDecodedLength(h)},w.decodedLength=function(h){return l.decodedLength(h)}},function(M,w,k){"use strict";Object.defineProperty(w,"__esModule",{value:!0});var d="utf8: invalid source encoding";function S(m){for(var l=0,b=0;b<m.length;b++){var g=m.charCodeAt(b);if(g<128)l+=1;else if(g<2048)l+=2;else if(g<55296)l+=3;else{if(!(g<=57343))throw new Error("utf8: invalid string");if(b>=m.length-1)throw new Error("utf8: invalid string");b++,l+=4}}return l}w.encode=function(m){for(var l=new Uint8Array(S(m)),b=0,g=0;g<m.length;g++){var h=m.charCodeAt(g);h<128?l[b++]=h:h<2048?(l[b++]=192|h>>6,l[b++]=128|63&h):h<55296?(l[b++]=224|h>>12,l[b++]=128|h>>6&63,l[b++]=128|63&h):(g++,h=(1023&h)<<10,h|=1023&m.charCodeAt(g),l[b++]=240|(h+=65536)>>18,l[b++]=128|h>>12&63,l[b++]=128|h>>6&63,l[b++]=128|63&h)}return l},w.encodedLength=S,w.decode=function(m){for(var l=[],b=0;b<m.length;b++){var g=m[b];if(128&g){var h=void 0;if(g<224){if(b>=m.length)throw new Error(d);if(128!=(192&(a=m[++b])))throw new Error(d);g=(31&g)<<6|63&a,h=128}else if(g<240){if(b>=m.length-1)throw new Error(d);var a=m[++b],u=m[++b];if(128!=(192&a)||128!=(192&u))throw new Error(d);g=(15&g)<<12|(63&a)<<6|63&u,h=2048}else{if(!(g<248))throw new Error(d);if(b>=m.length-2)throw new Error(d);a=m[++b],u=m[++b];var f=m[++b];if(128!=(192&a)||128!=(192&u)||128!=(192&f))throw new Error(d);g=(15&g)<<18|(63&a)<<12|(63&u)<<6|63&f,h=65536}if(g<h||g>=55296&&g<=57343)throw new Error(d);if(g>=65536){if(g>1114111)throw new Error(d);g-=65536,l.push(String.fromCharCode(55296|g>>10)),g=56320|1023&g}}l.push(String.fromCharCode(g))}return l.join("")}},function(M,w,k){M.exports=k(3).default},function(M,w,k){"use strict";k.r(w);for(var d,S=function(){function e(t,n){this.lastId=0,this.prefix=t,this.name=n}return e.prototype.create=function(t){this.lastId++;var n=this.lastId,r=this.prefix+n,o=this.name+"["+n+"]",i=!1,s=function(){i||(t.apply(null,arguments),i=!0)};return this[n]=s,{number:n,id:r,name:o,callback:s}},e.prototype.remove=function(t){delete this[t.number]},e}(),m=new S("_pusher_script_","Pusher.ScriptReceivers"),l={VERSION:"7.0.6",PROTOCOL:7,wsPort:80,wssPort:443,wsPath:"",httpHost:"sockjs.pusher.com",httpPort:80,httpsPort:443,httpPath:"/pusher",stats_host:"stats.pusher.com",authEndpoint:"/pusher/auth",authTransport:"ajax",activityTimeout:12e4,pongTimeout:3e4,unavailableTimeout:1e4,cluster:"mt1",cdn_http:"http://js.pusher.com",cdn_https:"https://js.pusher.com",dependency_suffix:""},b=function(){function e(t){this.options=t,this.receivers=t.receivers||m,this.loading={}}return e.prototype.load=function(t,n,r){var o=this;if(o.loading[t]&&o.loading[t].length>0)o.loading[t].push(r);else{o.loading[t]=[r];var i=v.createScriptRequest(o.getPath(t,n)),s=o.receivers.create(function(c){if(o.receivers.remove(s),o.loading[t]){var p=o.loading[t];delete o.loading[t];for(var y=function(P){P||i.cleanup()},_=0;_<p.length;_++)p[_](c,y)}});i.send(s)}},e.prototype.getRoot=function(t){var n=v.getDocument().location.protocol;return(t&&t.useTLS||"https:"===n?this.options.cdn_https:this.options.cdn_http).replace(/\/*$/,"")+"/"+this.options.version},e.prototype.getPath=function(t,n){return this.getRoot(n)+"/"+t+this.options.suffix+".js"},e}(),g=new S("_pusher_dependencies","Pusher.DependenciesReceivers"),h=new b({cdn_http:l.cdn_http,cdn_https:l.cdn_https,version:l.VERSION,suffix:l.dependency_suffix,receivers:g}),a={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/authenticating_users"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"},encryptedChannelSupport:{fullUrl:"https://github.com/pusher/pusher-js/tree/cc491015371a4bde5743d1c87a0fbac0feb53195#encrypted-channel-support"}}},u=function(e){var t,n=a.urls[e];return n?(n.fullUrl?t=n.fullUrl:n.path&&(t=a.baseUrl+n.path),t?"See: "+t:""):""},f=(d=function(e,t){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o])})(e,t)},function(e,t){function n(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),C=function(e){function t(n){var r=this.constructor,o=e.call(this,n)||this;return Object.setPrototypeOf(o,r.prototype),o}return f(t,e),t}(Error),A=function(e){function t(n){var r=this.constructor,o=e.call(this,n)||this;return Object.setPrototypeOf(o,r.prototype),o}return f(t,e),t}(Error),E=function(e){function t(n){var r=this.constructor,o=e.call(this,n)||this;return Object.setPrototypeOf(o,r.prototype),o}return f(t,e),t}(Error),R=function(e){function t(n){var r=this.constructor,o=e.call(this,n)||this;return Object.setPrototypeOf(o,r.prototype),o}return f(t,e),t}(Error),H=function(e){function t(n){var r=this.constructor,o=e.call(this,n)||this;return Object.setPrototypeOf(o,r.prototype),o}return f(t,e),t}(Error),D=function(e){function t(n){var r=this.constructor,o=e.call(this,n)||this;return Object.setPrototypeOf(o,r.prototype),o}return f(t,e),t}(Error),j=function(e){function t(n){var r=this.constructor,o=e.call(this,n)||this;return Object.setPrototypeOf(o,r.prototype),o}return f(t,e),t}(Error),I=function(e){function t(n,r){var o=this.constructor,i=e.call(this,r)||this;return i.status=n,Object.setPrototypeOf(i,o.prototype),i}return f(t,e),t}(Error),Wt=function(e,t,n){var r,o=this;for(var i in(r=v.createXHR()).open("POST",o.options.authEndpoint,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.authOptions.headers)r.setRequestHeader(i,this.authOptions.headers[i]);return r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status){var s=void 0,c=!1;try{s=JSON.parse(r.responseText),c=!0}catch{n(new I(200,"JSON returned from auth endpoint was invalid, yet status code was 200. Data was: "+r.responseText),{auth:""})}c&&n(null,s)}else{var p=u("authenticationEndpoint");n(new I(r.status,"Unable to retrieve auth string from auth endpoint - received status: "+r.status+" from "+o.options.authEndpoint+". Clients must be authenticated to join private or presence channels. "+p),{auth:""})}},r.send(this.composeQuery(t)),r},G=String.fromCharCode,J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Gt={},K=0;K<64;K++)Gt[J.charAt(K)]=K;var e,Vt=function(e){var t=e.charCodeAt(0);return t<128?e:t<2048?G(192|t>>>6)+G(128|63&t):G(224|t>>>12&15)+G(128|t>>>6&63)+G(128|63&t)},$t=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);return[J.charAt(n>>>18),J.charAt(n>>>12&63),t>=2?"=":J.charAt(n>>>6&63),t>=1?"=":J.charAt(63&n)].join("")},Kt=window.btoa||function(e){return e.replace(/[\s\S]{1,3}/g,$t)},gt=function(){function e(t,n,r,o){var i=this;this.clear=n,this.timer=t(function(){i.timer&&(i.timer=o(i.timer))},r)}return e.prototype.isRunning=function(){return null!==this.timer},e.prototype.ensureAborted=function(){this.timer&&(this.clear(this.timer),this.timer=null)},e}(),vt=(e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(t,n)},function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});function Zt(e){window.clearTimeout(e)}function te(e){window.clearInterval(e)}var B=function(e){function t(n,r){return e.call(this,setTimeout,Zt,n,function(o){return r(),null})||this}return vt(t,e),t}(gt),ee=function(e){function t(n,r){return e.call(this,setInterval,te,n,function(o){return r(),o})||this}return vt(t,e),t}(gt),O_now=function(){return Date.now?Date.now():(new Date).valueOf()},O_defer=function(e){return new B(0,e)},O_method=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Array.prototype.slice.call(arguments,1);return function(o){return o[e].apply(o,r.concat(arguments))}};function L(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r++){var o=t[r];for(var i in o)e[i]=o[i]&&o[i].constructor&&o[i].constructor===Object?L(e[i]||{},o[i]):o[i]}return e}function ne(){for(var e=["Pusher"],t=0;t<arguments.length;t++)e.push("string"==typeof arguments[t]?arguments[t]:Z(arguments[t]));return e.join(" : ")}function bt(e,t){var n=Array.prototype.indexOf;if(null===e)return-1;if(n&&e.indexOf===n)return e.indexOf(t);for(var r=0,o=e.length;r<o;r++)if(e[r]===t)return r;return-1}function q(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(e[n],n,e)}function mt(e){var t=[];return q(e,function(n,r){t.push(r)}),t}function Q(e,t,n){for(var r=0;r<e.length;r++)t.call(n||window,e[r],r,e)}function wt(e,t){for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r,e,n));return n}function _t(e,t){t=t||function(o){return!!o};for(var n=[],r=0;r<e.length;r++)t(e[r],r,e,n)&&n.push(e[r]);return n}function St(e,t){var n={};return q(e,function(r,o){(t&&t(r,o,e,n)||r)&&(n[o]=r)}),n}function kt(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1}function oe(e){var t,n;return wt((t=function re(e){return t=function(r){return"object"==typeof r&&(r=Z(r)),encodeURIComponent((o=r.toString(),Kt(function(e){return e.replace(/[^\x00-\x7F]/g,Vt)}(o))));var o},n={},q(e,function(r,o){n[o]=t(r)}),n;var t,n}(St(e,function(o){return void 0!==o})),n=[],q(t,function(o,i){n.push([i,o])}),n),O_method("join","=")).join("&")}function Z(e){try{return JSON.stringify(e)}catch{return JSON.stringify((t=[],n=[],function o(i,s){var c,p,y;switch(typeof i){case"object":if(!i)return null;for(c=0;c<t.length;c+=1)if(t[c]===i)return{$ref:n[c]};if(t.push(i),n.push(s),"[object Array]"===Object.prototype.toString.apply(i))for(y=[],c=0;c<i.length;c+=1)y[c]=o(i[c],s+"["+c+"]");else for(p in y={},i)Object.prototype.hasOwnProperty.call(i,p)&&(y[p]=o(i[p],s+"["+JSON.stringify(p)+"]"));return y;case"number":case"string":case"boolean":return i}}(e,"$")))}var t,n}var T=new(function(){function e(){this.globalLog=function(t){window.console&&window.console.log&&window.console.log(t)}}return e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.log(this.globalLog,t)},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.log(this.globalLogWarn,t)},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.log(this.globalLogError,t)},e.prototype.globalLogWarn=function(t){window.console&&window.console.warn?window.console.warn(t):this.globalLog(t)},e.prototype.globalLogError=function(t){window.console&&window.console.error?window.console.error(t):this.globalLogWarn(t)},e.prototype.log=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=ne.apply(this,arguments);lt.log?lt.log(o):lt.logToConsole&&t.bind(this)(o)},e}()),ie=function(e,t,n){void 0!==this.authOptions.headers&&T.warn("To send headers with the auth request, you must use AJAX, rather than JSONP.");var r=e.nextAuthCallbackID.toString();e.nextAuthCallbackID++;var o=e.getDocument(),i=o.createElement("script");e.auth_callbacks[r]=function(p){n(null,p)},i.src=this.options.authEndpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+r+"']")+"&"+this.composeQuery(t);var c=o.getElementsByTagName("head")[0]||o.documentElement;c.insertBefore(i,c.firstChild)},se=function(){function e(t){this.src=t}return e.prototype.send=function(t){var n=this,r="Error loading "+n.src;n.script=document.createElement("script"),n.script.id=t.id,n.script.src=n.src,n.script.type="text/javascript",n.script.charset="UTF-8",n.script.addEventListener?(n.script.onerror=function(){t.callback(r)},n.script.onload=function(){t.callback(null)}):n.script.onreadystatechange=function(){"loaded"!==n.script.readyState&&"complete"!==n.script.readyState||t.callback(null)},void 0===n.script.async&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(n.errorScript=document.createElement("script"),n.errorScript.id=t.id+"_error",n.errorScript.text=t.name+"('"+r+"');",n.script.async=n.errorScript.async=!1):n.script.async=!0;var o=document.getElementsByTagName("head")[0];o.insertBefore(n.script,o.firstChild),n.errorScript&&o.insertBefore(n.errorScript,n.script.nextSibling)},e.prototype.cleanup=function(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null},e}(),ce=function(){function e(t,n){this.url=t,this.data=n}return e.prototype.send=function(t){if(!this.request){var n=oe(this.data);this.request=v.createScriptRequest(this.url+"/"+t.number+"?"+n),this.request.send(t)}},e.prototype.cleanup=function(){this.request&&this.request.cleanup()},e}(),ae={name:"jsonp",getAgent:function(e,t){return function(n,r){var i=v.createJSONPRequest("http"+(t?"s":"")+"://"+(e.host||e.options.host)+e.options.path,n),s=v.ScriptReceivers.create(function(c,p){m.remove(s),i.cleanup(),p&&p.host&&(e.host=p.host),r&&r(c,p)});i.send(s)}}};function rt(e,t,n){return e+(t.useTLS?"s":"")+"://"+(t.useTLS?t.hostTLS:t.hostNonTLS)+n}function ot(e,t){return"/app/"+e+"?protocol="+l.PROTOCOL+"&client=js&version="+l.VERSION+(t?"&"+t:"")}var ue={getInitial:function(e,t){return rt("ws",t,(t.httpPath||"")+ot(e,"flash=false"))}},he={getInitial:function(e,t){return rt("http",t,(t.httpPath||"/pusher")+ot(e))}},pe={getInitial:function(e,t){return rt("http",t,t.httpPath||"/pusher")},getPath:function(e,t){return ot(e)}},le=function(){function e(){this._callbacks={}}return e.prototype.get=function(t){return this._callbacks[it(t)]},e.prototype.add=function(t,n,r){var o=it(t);this._callbacks[o]=this._callbacks[o]||[],this._callbacks[o].push({fn:n,context:r})},e.prototype.remove=function(t,n,r){if(t||n||r){var o=t?[it(t)]:mt(this._callbacks);n||r?this.removeCallback(o,n,r):this.removeAllCallbacks(o)}else this._callbacks={}},e.prototype.removeCallback=function(t,n,r){Q(t,function(o){this._callbacks[o]=_t(this._callbacks[o]||[],function(i){return n&&n!==i.fn||r&&r!==i.context}),0===this._callbacks[o].length&&delete this._callbacks[o]},this)},e.prototype.removeAllCallbacks=function(t){Q(t,function(n){delete this._callbacks[n]},this)},e}();function it(e){return"_"+e}var z=function(){function e(t){this.callbacks=new le,this.global_callbacks=[],this.failThrough=t}return e.prototype.bind=function(t,n,r){return this.callbacks.add(t,n,r),this},e.prototype.bind_global=function(t){return this.global_callbacks.push(t),this},e.prototype.unbind=function(t,n,r){return this.callbacks.remove(t,n,r),this},e.prototype.unbind_global=function(t){return t?(this.global_callbacks=_t(this.global_callbacks||[],function(n){return n!==t}),this):(this.global_callbacks=[],this)},e.prototype.unbind_all=function(){return this.unbind(),this.unbind_global(),this},e.prototype.emit=function(t,n,r){for(var o=0;o<this.global_callbacks.length;o++)this.global_callbacks[o](t,n);var i=this.callbacks.get(t),s=[];if(r?s.push(n,r):n&&s.push(n),i&&i.length>0)for(o=0;o<i.length;o++)i[o].fn.apply(i[o].context||window,s);else this.failThrough&&this.failThrough(t,n);return this},e}(),fe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),de=function(e){function t(n,r,o,i,s){var c=e.call(this)||this;return c.initialize=v.transportConnectionInitializer,c.hooks=n,c.name=r,c.priority=o,c.key=i,c.options=s,c.state="new",c.timeline=s.timeline,c.activityTimeout=s.activityTimeout,c.id=c.timeline.generateUniqueID(),c}return fe(t,e),t.prototype.handlesActivityChecks=function(){return!!this.hooks.handlesActivityChecks},t.prototype.supportsPing=function(){return!!this.hooks.supportsPing},t.prototype.connect=function(){var n=this;if(this.socket||"initialized"!==this.state)return!1;var r=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(r,this.options)}catch(o){return O_defer(function(){n.onError(o),n.changeState("closed")}),!1}return this.bindListeners(),T.debug("Connecting",{transport:this.name,url:r}),this.changeState("connecting"),!0},t.prototype.close=function(){return!!this.socket&&(this.socket.close(),!0)},t.prototype.send=function(n){var r=this;return"open"===this.state&&(O_defer(function(){r.socket&&r.socket.send(n)}),!0)},t.prototype.ping=function(){"open"===this.state&&this.supportsPing()&&this.socket.ping()},t.prototype.onOpen=function(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0},t.prototype.onError=function(n){this.emit("error",{type:"WebSocketError",error:n}),this.timeline.error(this.buildTimelineMessage({error:n.toString()}))},t.prototype.onClose=function(n){n?this.changeState("closed",{code:n.code,reason:n.reason,wasClean:n.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0},t.prototype.onMessage=function(n){this.emit("message",n)},t.prototype.onActivity=function(){this.emit("activity")},t.prototype.bindListeners=function(){var n=this;this.socket.onopen=function(){n.onOpen()},this.socket.onerror=function(r){n.onError(r)},this.socket.onclose=function(r){n.onClose(r)},this.socket.onmessage=function(r){n.onMessage(r)},this.supportsPing()&&(this.socket.onactivity=function(){n.onActivity()})},t.prototype.unbindListeners=function(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))},t.prototype.changeState=function(n,r){this.state=n,this.timeline.info(this.buildTimelineMessage({state:n,params:r})),this.emit(n,r)},t.prototype.buildTimelineMessage=function(n){return L({cid:this.id},n)},t}(z),W=function(){function e(t){this.hooks=t}return e.prototype.isSupported=function(t){return this.hooks.isSupported(t)},e.prototype.createConnection=function(t,n,r,o){return new de(this.hooks,t,n,r,o)},e}(),ye=new W({urls:ue,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return!!v.getWebSocketAPI()},isSupported:function(){return!!v.getWebSocketAPI()},getSocket:function(e){return v.createWebSocket(e)}}),Ct={urls:he,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return!0}},Tt=L({getSocket:function(e){return v.HTTPFactory.createStreamingSocket(e)}},Ct),Pt=L({getSocket:function(e){return v.HTTPFactory.createPollingSocket(e)}},Ct),Ot={isSupported:function(){return v.isXHRSupported()}},tt={ws:ye,xhr_streaming:new W(L({},Tt,Ot)),xhr_polling:new W(L({},Pt,Ot))},ge=new W({file:"sockjs",urls:pe,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return void 0!==window.SockJS},getSocket:function(e,t){return new window.SockJS(e,null,{js_path:h.getPath("sockjs",{useTLS:t.useTLS}),ignore_null_origin:t.ignoreNullOrigin})},beforeOpen:function(e,t){e.send(JSON.stringify({path:t}))}}),Et={isSupported:function(e){return v.isXDRSupported(e.useTLS)}},ve=new W(L({},Tt,Et)),be=new W(L({},Pt,Et));tt.xdr_streaming=ve,tt.xdr_polling=be,tt.sockjs=ge;var me=tt,we=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_e=new(function(e){function t(){var n=e.call(this)||this,r=n;return void 0!==window.addEventListener&&(window.addEventListener("online",function(){r.emit("online")},!1),window.addEventListener("offline",function(){r.emit("offline")},!1)),n}return we(t,e),t.prototype.isOnline=function(){return void 0===window.navigator.onLine||window.navigator.onLine},t}(z)),Se=function(){function e(t,n,r){this.manager=t,this.transport=n,this.minPingDelay=r.minPingDelay,this.maxPingDelay=r.maxPingDelay,this.pingDelay=void 0}return e.prototype.createConnection=function(t,n,r,o){var i=this;o=L({},o,{activityTimeout:this.pingDelay});var s=this.transport.createConnection(t,n,r,o),c=null,p=function(){s.unbind("open",p),s.bind("closed",y),c=O_now()},y=function(_){if(s.unbind("closed",y),1002===_.code||1003===_.code)i.manager.reportDeath();else if(!_.wasClean&&c){var P=O_now()-c;P<2*i.maxPingDelay&&(i.manager.reportDeath(),i.pingDelay=Math.max(P/2,i.minPingDelay))}};return s.bind("open",p),s},e.prototype.isSupported=function(t){return this.manager.isAlive()&&this.transport.isSupported(t)},e}(),Lt={decodeMessage:function(e){try{var t=JSON.parse(e.data),n=t.data;if("string"==typeof n)try{n=JSON.parse(t.data)}catch{}var r={event:t.event,channel:t.channel,data:n};return t.user_id&&(r.user_id=t.user_id),r}catch(o){throw{type:"MessageParseError",error:o,data:e.data}}},encodeMessage:function(e){return JSON.stringify(e)},processHandshake:function(e){var t=Lt.decodeMessage(e);if("pusher:connection_established"===t.event){if(!t.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:t.data.socket_id,activityTimeout:1e3*t.data.activity_timeout}}if("pusher:error"===t.event)return{action:this.getCloseAction(t.data),error:this.getCloseError(t.data)};throw"Invalid handshake"},getCloseAction:function(e){return e.code<4e3?e.code>=1002&&e.code<=1004?"backoff":null:4e3===e.code?"tls_only":e.code<4100?"refused":e.code<4200?"backoff":e.code<4300?"retry":"refused"},getCloseError:function(e){return 1e3!==e.code&&1001!==e.code?{type:"PusherError",data:{code:e.code,message:e.reason||e.message}}:null}},U=Lt,ke=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ce=function(e){function t(n,r){var o=e.call(this)||this;return o.id=n,o.transport=r,o.activityTimeout=r.activityTimeout,o.bindListeners(),o}return ke(t,e),t.prototype.handlesActivityChecks=function(){return this.transport.handlesActivityChecks()},t.prototype.send=function(n){return this.transport.send(n)},t.prototype.send_event=function(n,r,o){var i={event:n,data:r};return o&&(i.channel=o),T.debug("Event sent",i),this.send(U.encodeMessage(i))},t.prototype.ping=function(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})},t.prototype.close=function(){this.transport.close()},t.prototype.bindListeners=function(){var n=this,r={message:function(i){var s;try{s=U.decodeMessage(i)}catch(c){n.emit("error",{type:"MessageParseError",error:c,data:i.data})}if(void 0!==s){switch(T.debug("Event recd",s),s.event){case"pusher:error":n.emit("error",{type:"PusherError",data:s.data});break;case"pusher:ping":n.emit("ping");break;case"pusher:pong":n.emit("pong")}n.emit("message",s)}},activity:function(){n.emit("activity")},error:function(i){n.emit("error",i)},closed:function(i){o(),i&&i.code&&n.handleCloseEvent(i),n.transport=null,n.emit("closed")}},o=function(){q(r,function(i,s){n.transport.unbind(s,i)})};q(r,function(i,s){n.transport.bind(s,i)})},t.prototype.handleCloseEvent=function(n){var r=U.getCloseAction(n),o=U.getCloseError(n);o&&this.emit("error",o),r&&this.emit(r,{action:r,error:o})},t}(z),Te=function(){function e(t,n){this.transport=t,this.callback=n,this.bindListeners()}return e.prototype.close=function(){this.unbindListeners(),this.transport.close()},e.prototype.bindListeners=function(){var t=this;this.onMessage=function(n){var r;t.unbindListeners();try{r=U.processHandshake(n)}catch(o){return t.finish("error",{error:o}),void t.transport.close()}"connected"===r.action?t.finish("connected",{connection:new Ce(r.id,t.transport),activityTimeout:r.activityTimeout}):(t.finish(r.action,{error:r.error}),t.transport.close())},this.onClosed=function(n){t.unbindListeners();var r=U.getCloseAction(n)||"backoff",o=U.getCloseError(n);t.finish(r,{error:o})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)},e.prototype.unbindListeners=function(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)},e.prototype.finish=function(t,n){this.callback(L({transport:this.transport,action:t},n))},e}(),Pe=function(){function e(t,n){this.channel=t;var r=n.authTransport;if(void 0===v.getAuthorizers()[r])throw"'"+r+"' is not a recognized auth transport";this.type=r,this.options=n,this.authOptions=n.auth||{}}return e.prototype.composeQuery=function(t){var n="socket_id="+encodeURIComponent(t)+"&channel_name="+encodeURIComponent(this.channel.name);for(var r in this.authOptions.params)n+="&"+encodeURIComponent(r)+"="+encodeURIComponent(this.authOptions.params[r]);return n},e.prototype.authorize=function(t,n){(e.authorizers=e.authorizers||v.getAuthorizers())[this.type].call(this,v,t,n)},e}(),Oe=function(){function e(t,n){this.timeline=t,this.options=n||{}}return e.prototype.send=function(t,n){this.timeline.isEmpty()||this.timeline.send(v.TimelineTransport.getAgent(this,t),n)},e}(),Ee=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xt=function(e){function t(n,r){var o=e.call(this,function(i,s){T.debug("No callbacks on "+n+" for "+i)})||this;return o.name=n,o.pusher=r,o.subscribed=!1,o.subscriptionPending=!1,o.subscriptionCancelled=!1,o}return Ee(t,e),t.prototype.authorize=function(n,r){return r(null,{auth:""})},t.prototype.trigger=function(n,r){if(0!==n.indexOf("client-"))throw new C("Event '"+n+"' does not start with 'client-'");if(!this.subscribed){var o=u("triggeringClientEvents");T.warn("Client event triggered before channel 'subscription_succeeded' event . "+o)}return this.pusher.send_event(n,r,this.name)},t.prototype.disconnect=function(){this.subscribed=!1,this.subscriptionPending=!1},t.prototype.handleEvent=function(n){var r=n.event,o=n.data;"pusher_internal:subscription_succeeded"===r?this.handleSubscriptionSucceededEvent(n):0!==r.indexOf("pusher_internal:")&&this.emit(r,o,{})},t.prototype.handleSubscriptionSucceededEvent=function(n){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):this.emit("pusher:subscription_succeeded",n.data)},t.prototype.subscribe=function(){var n=this;this.subscribed||(this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,function(r,o){r?(n.subscriptionPending=!1,T.error(r.toString()),n.emit("pusher:subscription_error",Object.assign({},{type:"AuthError",error:r.message},r instanceof I?{status:r.status}:{}))):n.pusher.send_event("pusher:subscribe",{auth:o.auth,channel_data:o.channel_data,channel:n.name})}))},t.prototype.unsubscribe=function(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})},t.prototype.cancelSubscription=function(){this.subscriptionCancelled=!0},t.prototype.reinstateSubscription=function(){this.subscriptionCancelled=!1},t}(z),Le=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),st=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Le(t,e),t.prototype.authorize=function(n,r){return N.createAuthorizer(this,this.pusher.config).authorize(n,r)},t}(xt),xe=function(){function e(){this.reset()}return e.prototype.get=function(t){return Object.prototype.hasOwnProperty.call(this.members,t)?{id:t,info:this.members[t]}:null},e.prototype.each=function(t){var n=this;q(this.members,function(r,o){t(n.get(o))})},e.prototype.setMyID=function(t){this.myID=t},e.prototype.onSubscription=function(t){this.members=t.presence.hash,this.count=t.presence.count,this.me=this.get(this.myID)},e.prototype.addMember=function(t){return null===this.get(t.user_id)&&this.count++,this.members[t.user_id]=t.user_info,this.get(t.user_id)},e.prototype.removeMember=function(t){var n=this.get(t.user_id);return n&&(delete this.members[t.user_id],this.count--),n},e.prototype.reset=function(){this.members={},this.count=0,this.myID=null,this.me=null},e}(),Ae=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Re=function(e){function t(n,r){var o=e.call(this,n,r)||this;return o.members=new xe,o}return Ae(t,e),t.prototype.authorize=function(n,r){var o=this;e.prototype.authorize.call(this,n,function(i,s){if(!i){if(void 0===s.channel_data){var c=u("authenticationEndpoint");return T.error("Invalid auth response for channel '"+o.name+"',expected 'channel_data' field. "+c),void r("Invalid auth response")}var p=JSON.parse(s.channel_data);o.members.setMyID(p.user_id)}r(i,s)})},t.prototype.handleEvent=function(n){var r=n.event;if(0===r.indexOf("pusher_internal:"))this.handleInternalEvent(n);else{var o=n.data,i={};n.user_id&&(i.user_id=n.user_id),this.emit(r,o,i)}},t.prototype.handleInternalEvent=function(n){var o=n.data;switch(n.event){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(n);break;case"pusher_internal:member_added":var i=this.members.addMember(o);this.emit("pusher:member_added",i);break;case"pusher_internal:member_removed":var s=this.members.removeMember(o);s&&this.emit("pusher:member_removed",s)}},t.prototype.handleSubscriptionSucceededEvent=function(n){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):(this.members.onSubscription(n.data),this.emit("pusher:subscription_succeeded",this.members))},t.prototype.disconnect=function(){this.members.reset(),e.prototype.disconnect.call(this)},t}(st),je=k(1),ct=k(0),De=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ie=function(e){function t(n,r,o){var i=e.call(this,n,r)||this;return i.key=null,i.nacl=o,i}return De(t,e),t.prototype.authorize=function(n,r){var o=this;e.prototype.authorize.call(this,n,function(i,s){if(i)r(i,s);else{var c=s.shared_secret;c?(o.key=Object(ct.decode)(c),delete s.shared_secret,r(null,s)):r(new Error("No shared_secret key in auth payload for encrypted channel: "+o.name),null)}})},t.prototype.trigger=function(n,r){throw new H("Client events are not currently supported for encrypted channels")},t.prototype.handleEvent=function(n){var r=n.event,o=n.data;0!==r.indexOf("pusher_internal:")&&0!==r.indexOf("pusher:")?this.handleEncryptedEvent(r,o):e.prototype.handleEvent.call(this,n)},t.prototype.handleEncryptedEvent=function(n,r){var o=this;if(this.key)if(r.ciphertext&&r.nonce){var i=Object(ct.decode)(r.ciphertext);if(i.length<this.nacl.secretbox.overheadLength)T.error("Expected encrypted event ciphertext length to be "+this.nacl.secretbox.overheadLength+", got: "+i.length);else{var s=Object(ct.decode)(r.nonce);if(s.length<this.nacl.secretbox.nonceLength)T.error("Expected encrypted event nonce length to be "+this.nacl.secretbox.nonceLength+", got: "+s.length);else{var c=this.nacl.secretbox.open(i,s,this.key);if(null===c)return T.debug("Failed to decrypt an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint..."),void this.authorize(this.pusher.connection.socket_id,function(p,y){p?T.error("Failed to make a request to the authEndpoint: "+y+". Unable to fetch new key, so dropping encrypted event"):null!==(c=o.nacl.secretbox.open(i,s,o.key))?o.emit(n,o.getDataToEmit(c)):T.error("Failed to decrypt event with new key. Dropping encrypted event")});this.emit(n,this.getDataToEmit(c))}}}else T.error("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+r);else T.debug("Received encrypted event before key has been retrieved from the authEndpoint")},t.prototype.getDataToEmit=function(n){var r=Object(je.decode)(n);try{return JSON.parse(r)}catch{return r}},t}(st),Ne=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Me=function(e){function t(n,r){var o=e.call(this)||this;o.state="initialized",o.connection=null,o.key=n,o.options=r,o.timeline=o.options.timeline,o.usingTLS=o.options.useTLS,o.errorCallbacks=o.buildErrorCallbacks(),o.connectionCallbacks=o.buildConnectionCallbacks(o.errorCallbacks),o.handshakeCallbacks=o.buildHandshakeCallbacks(o.errorCallbacks);var i=v.getNetwork();return i.bind("online",function(){o.timeline.info({netinfo:"online"}),"connecting"!==o.state&&"unavailable"!==o.state||o.retryIn(0)}),i.bind("offline",function(){o.timeline.info({netinfo:"offline"}),o.connection&&o.sendActivityCheck()}),o.updateStrategy(),o}return Ne(t,e),t.prototype.connect=function(){this.connection||this.runner||(this.strategy.isSupported()?(this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()):this.updateState("failed"))},t.prototype.send=function(n){return!!this.connection&&this.connection.send(n)},t.prototype.send_event=function(n,r,o){return!!this.connection&&this.connection.send_event(n,r,o)},t.prototype.disconnect=function(){this.disconnectInternally(),this.updateState("disconnected")},t.prototype.isUsingTLS=function(){return this.usingTLS},t.prototype.startConnecting=function(){var n=this,r=function(o,i){o?n.runner=n.strategy.connect(0,r):"error"===i.action?(n.emit("error",{type:"HandshakeError",error:i.error}),n.timeline.error({handshakeError:i.error})):(n.abortConnecting(),n.handshakeCallbacks[i.action](i))};this.runner=this.strategy.connect(0,r)},t.prototype.abortConnecting=function(){this.runner&&(this.runner.abort(),this.runner=null)},t.prototype.disconnectInternally=function(){this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection&&this.abandonConnection().close()},t.prototype.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})},t.prototype.retryIn=function(n){var r=this;this.timeline.info({action:"retry",delay:n}),n>0&&this.emit("connecting_in",Math.round(n/1e3)),this.retryTimer=new B(n||0,function(){r.disconnectInternally(),r.connect()})},t.prototype.clearRetryTimer=function(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)},t.prototype.setUnavailableTimer=function(){var n=this;this.unavailableTimer=new B(this.options.unavailableTimeout,function(){n.updateState("unavailable")})},t.prototype.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()},t.prototype.sendActivityCheck=function(){var n=this;this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new B(this.options.pongTimeout,function(){n.timeline.error({pong_timed_out:n.options.pongTimeout}),n.retryIn(0)})},t.prototype.resetActivityCheck=function(){var n=this;this.stopActivityCheck(),this.connection&&!this.connection.handlesActivityChecks()&&(this.activityTimer=new B(this.activityTimeout,function(){n.sendActivityCheck()}))},t.prototype.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()},t.prototype.buildConnectionCallbacks=function(n){var r=this;return L({},n,{message:function(o){r.resetActivityCheck(),r.emit("message",o)},ping:function(){r.send_event("pusher:pong",{})},activity:function(){r.resetActivityCheck()},error:function(o){r.emit("error",o)},closed:function(){r.abandonConnection(),r.shouldRetry()&&r.retryIn(1e3)}})},t.prototype.buildHandshakeCallbacks=function(n){var r=this;return L({},n,{connected:function(o){r.activityTimeout=Math.min(r.options.activityTimeout,o.activityTimeout,o.connection.activityTimeout||1/0),r.clearUnavailableTimer(),r.setConnection(o.connection),r.socket_id=r.connection.id,r.updateState("connected",{socket_id:r.socket_id})}})},t.prototype.buildErrorCallbacks=function(){var n=this,r=function(o){return function(i){i.error&&n.emit("error",{type:"WebSocketError",error:i.error}),o(i)}};return{tls_only:r(function(){n.usingTLS=!0,n.updateStrategy(),n.retryIn(0)}),refused:r(function(){n.disconnect()}),backoff:r(function(){n.retryIn(1e3)}),retry:r(function(){n.retryIn(0)})}},t.prototype.setConnection=function(n){for(var r in this.connection=n,this.connectionCallbacks)this.connection.bind(r,this.connectionCallbacks[r]);this.resetActivityCheck()},t.prototype.abandonConnection=function(){if(this.connection){for(var n in this.stopActivityCheck(),this.connectionCallbacks)this.connection.unbind(n,this.connectionCallbacks[n]);var r=this.connection;return this.connection=null,r}},t.prototype.updateState=function(n,r){var o=this.state;if(this.state=n,o!==n){var i=n;"connected"===i&&(i+=" with new socket ID "+r.socket_id),T.debug("State changed",o+" -> "+i),this.timeline.info({state:n,params:r}),this.emit("state_change",{previous:o,current:n}),this.emit(n,r)}},t.prototype.shouldRetry=function(){return"connecting"===this.state||"connected"===this.state},t}(z),He=function(){function e(){this.channels={}}return e.prototype.add=function(t,n){return this.channels[t]||(this.channels[t]=function(r,o){if(0===r.indexOf("private-encrypted-")){if(o.config.nacl)return N.createEncryptedChannel(r,o,o.config.nacl);var i=u("encryptedChannelSupport");throw new H("Tried to subscribe to a private-encrypted- channel but no nacl implementation available. "+i)}return 0===r.indexOf("private-")?N.createPrivateChannel(r,o):0===r.indexOf("presence-")?N.createPresenceChannel(r,o):N.createChannel(r,o)}(t,n)),this.channels[t]},e.prototype.all=function(){return n=[],q(this.channels,function(r){n.push(r)}),n;var n},e.prototype.find=function(t){return this.channels[t]},e.prototype.remove=function(t){var n=this.channels[t];return delete this.channels[t],n},e.prototype.disconnect=function(){q(this.channels,function(t){t.disconnect()})},e}(),N={createChannels:function(){return new He},createConnectionManager:function(e,t){return new Me(e,t)},createChannel:function(e,t){return new xt(e,t)},createPrivateChannel:function(e,t){return new st(e,t)},createPresenceChannel:function(e,t){return new Re(e,t)},createEncryptedChannel:function(e,t,n){return new Ie(e,t,n)},createTimelineSender:function(e,t){return new Oe(e,t)},createAuthorizer:function(e,t){return t.authorizer?t.authorizer(e,t):new Pe(e,t)},createHandshake:function(e,t){return new Te(e,t)},createAssistantToTheTransportManager:function(e,t,n){return new Se(e,t,n)}},At=function(){function e(t){this.options=t||{},this.livesLeft=this.options.lives||1/0}return e.prototype.getAssistant=function(t){return N.createAssistantToTheTransportManager(this,t,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})},e.prototype.isAlive=function(){return this.livesLeft>0},e.prototype.reportDeath=function(){this.livesLeft-=1},e}(),F=function(){function e(t,n){this.strategies=t,this.loop=!!n.loop,this.failFast=!!n.failFast,this.timeout=n.timeout,this.timeoutLimit=n.timeoutLimit}return e.prototype.isSupported=function(){return kt(this.strategies,O_method("isSupported"))},e.prototype.connect=function(t,n){var r=this,o=this.strategies,i=0,s=this.timeout,c=null,p=function(y,_){_?n(null,_):(i+=1,r.loop&&(i%=o.length),i<o.length?(s&&(s*=2,r.timeoutLimit&&(s=Math.min(s,r.timeoutLimit))),c=r.tryStrategy(o[i],t,{timeout:s,failFast:r.failFast},p)):n(!0))};return c=this.tryStrategy(o[i],t,{timeout:s,failFast:this.failFast},p),{abort:function(){c.abort()},forceMinPriority:function(y){t=y,c&&c.forceMinPriority(y)}}},e.prototype.tryStrategy=function(t,n,r,o){var i=null,s=null;return r.timeout>0&&(i=new B(r.timeout,function(){s.abort(),o(!0)})),s=t.connect(n,function(c,p){c&&i&&i.isRunning()&&!r.failFast||(i&&i.ensureAborted(),o(c,p))}),{abort:function(){i&&i.ensureAborted(),s.abort()},forceMinPriority:function(c){s.forceMinPriority(c)}}},e}(),at=function(){function e(t){this.strategies=t}return e.prototype.isSupported=function(){return kt(this.strategies,O_method("isSupported"))},e.prototype.connect=function(t,n){return o=t,s=wt(this.strategies,function(c,p,y,_){return c.connect(o,function(r,o){return function(i,s){o[r].error=i,i?function(c){return function(p,y){for(var _=0;_<p.length;_++)if(!y(p[_]))return!1;return!0}(c,function(p){return!!p.error})}(o)&&n(!0):(Q(o,function(c){c.forceMinPriority(s.transport.priority)}),n(null,s))}}(p,_))}),{abort:function(){Q(s,qe)},forceMinPriority:function(c){Q(s,function(p){p.forceMinPriority(c)})}};var o,s},e}();function qe(e){e.error||e.aborted||(e.abort(),e.aborted=!0)}var Be=function(){function e(t,n,r){this.strategy=t,this.transports=n,this.ttl=r.ttl||18e5,this.usingTLS=r.useTLS,this.timeline=r.timeline}return e.prototype.isSupported=function(){return this.strategy.isSupported()},e.prototype.connect=function(t,n){var r=this.usingTLS,o=function(y){var _=v.getLocalStorage();if(_)try{var P=_[ut(y)];if(P)return JSON.parse(P)}catch{Rt(y)}return null}(r),i=[this.strategy];if(o&&o.timestamp+this.ttl>=O_now()){var s=this.transports[o.transport];s&&(this.timeline.info({cached:!0,transport:o.transport,latency:o.latency}),i.push(new F([s],{timeout:2*o.latency+1e3,failFast:!0})))}var c=O_now(),p=i.pop().connect(t,function y(_,P){_?(Rt(r),i.length>0?(c=O_now(),p=i.pop().connect(t,y)):n(_)):(function(x,ft,dt){var $=v.getLocalStorage();if($)try{$[ut(x)]=Z({timestamp:O_now(),transport:ft,latency:dt})}catch{}}(r,P.transport.name,O_now()-c),n(null,P))});return{abort:function(){p.abort()},forceMinPriority:function(y){t=y,p&&p.forceMinPriority(y)}}},e}();function ut(e){return"pusherTransport"+(e?"TLS":"NonTLS")}function Rt(e){var t=v.getLocalStorage();if(t)try{delete t[ut(e)]}catch{}}var et=function(){function e(t,n){var r=n.delay;this.strategy=t,this.options={delay:r}}return e.prototype.isSupported=function(){return this.strategy.isSupported()},e.prototype.connect=function(t,n){var r,o=this.strategy,i=new B(this.options.delay,function(){r=o.connect(t,n)});return{abort:function(){i.ensureAborted(),r&&r.abort()},forceMinPriority:function(s){t=s,r&&r.forceMinPriority(s)}}},e}(),V=function(){function e(t,n,r){this.test=t,this.trueBranch=n,this.falseBranch=r}return e.prototype.isSupported=function(){return(this.test()?this.trueBranch:this.falseBranch).isSupported()},e.prototype.connect=function(t,n){return(this.test()?this.trueBranch:this.falseBranch).connect(t,n)},e}(),ze=function(){function e(t){this.strategy=t}return e.prototype.isSupported=function(){return this.strategy.isSupported()},e.prototype.connect=function(t,n){var r=this.strategy.connect(t,function(o,i){i&&r.abort(),n(o,i)});return r},e}();function Y(e){return function(){return e.isSupported()}}var ht,Fe={getRequest:function(e){var t=new window.XDomainRequest;return t.ontimeout=function(){e.emit("error",new A),e.close()},t.onerror=function(n){e.emit("error",n),e.close()},t.onprogress=function(){t.responseText&&t.responseText.length>0&&e.onChunk(200,t.responseText)},t.onload=function(){t.responseText&&t.responseText.length>0&&e.onChunk(200,t.responseText),e.emit("finished",200),e.close()},t},abortRequest:function(e){e.ontimeout=e.onerror=e.onprogress=e.onload=null,e.abort()}},Xe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)o.hasOwnProperty(i)&&(r[i]=o[i])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Je=function(e){function t(n,r,o){var i=e.call(this)||this;return i.hooks=n,i.method=r,i.url=o,i}return Xe(t,e),t.prototype.start=function(n){var r=this;this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=function(){r.close()},v.addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader&&this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(n)},t.prototype.close=function(){this.unloader&&(v.removeUnloadListener(this.unloader),this.unloader=null),this.xhr&&(this.hooks.abortRequest(this.xhr),this.xhr=null)},t.prototype.onChunk=function(n,r){for(;;){var o=this.advanceBuffer(r);if(!o)break;this.emit("chunk",{status:n,data:o})}this.isBufferTooLong(r)&&this.emit("buffer_too_long")},t.prototype.advanceBuffer=function(n){var r=n.slice(this.position),o=r.indexOf("\n");return-1!==o?(this.position+=o+1,r.slice(0,o)):null},t.prototype.isBufferTooLong=function(n){return this.position===n.length&&n.length>262144},t}(z);!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSED=3]="CLOSED"}(ht||(ht={}));var X=ht,We=1;function jt(e){var t=-1===e.indexOf("?")?"?":"&";return e+t+"t="+ +new Date+"&n="+We++}function Dt(e){return Math.floor(Math.random()*e)}var pt,Ge=function(){function e(t,n){var o;this.hooks=t,this.session=Dt(1e3)+"/"+function(r){for(var o=[],i=0;i<8;i++)o.push(Dt(32).toString(32));return o.join("")}(),this.location={base:(o=/([^\?]*)\/*(\??.*)/.exec(n))[1],queryString:o[2]},this.readyState=X.CONNECTING,this.openStream()}return e.prototype.send=function(t){return this.sendRaw(JSON.stringify([t]))},e.prototype.ping=function(){this.hooks.sendHeartbeat(this)},e.prototype.close=function(t,n){this.onClose(t,n,!0)},e.prototype.sendRaw=function(t){if(this.readyState!==X.OPEN)return!1;try{return v.createSocketRequest("POST",jt((n=this.location,r=this.session,n.base+"/"+r+"/xhr_send"))).start(t),!0}catch{return!1}var n,r},e.prototype.reconnect=function(){this.closeStream(),this.openStream()},e.prototype.onClose=function(t,n,r){this.closeStream(),this.readyState=X.CLOSED,this.onclose&&this.onclose({code:t,reason:n,wasClean:r})},e.prototype.onChunk=function(t){var n;if(200===t.status)switch(this.readyState===X.OPEN&&this.onActivity(),t.data.slice(0,1)){case"o":n=JSON.parse(t.data.slice(1)||"{}"),this.onOpen(n);break;case"a":n=JSON.parse(t.data.slice(1)||"[]");for(var r=0;r<n.length;r++)this.onEvent(n[r]);break;case"m":n=JSON.parse(t.data.slice(1)||"null"),this.onEvent(n);break;case"h":this.hooks.onHeartbeat(this);break;case"c":n=JSON.parse(t.data.slice(1)||"[]"),this.onClose(n[0],n[1],!0)}},e.prototype.onOpen=function(t){var r,o;this.readyState===X.CONNECTING?(t&&t.hostname&&(this.location.base=(r=t.hostname,(o=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(this.location.base))[1]+r+o[3])),this.readyState=X.OPEN,this.onopen&&this.onopen()):this.onClose(1006,"Server lost session",!0)},e.prototype.onEvent=function(t){this.readyState===X.OPEN&&this.onmessage&&this.onmessage({data:t})},e.prototype.onActivity=function(){this.onactivity&&this.onactivity()},e.prototype.onError=function(t){this.onerror&&this.onerror(t)},e.prototype.openStream=function(){var t=this;this.stream=v.createSocketRequest("POST",jt(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",function(n){t.onChunk(n)}),this.stream.bind("finished",function(n){t.hooks.onFinished(t,n)}),this.stream.bind("buffer_too_long",function(){t.reconnect()});try{this.stream.start()}catch(n){O_defer(function(){t.onError(n),t.onClose(1006,"Could not start streaming",!1)})}},e.prototype.closeStream=function(){this.stream&&(this.stream.unbind_all(),this.stream.close(),this.stream=null)},e}(),Qe={getReceiveURL:function(e,t){return e.base+"/"+t+"/xhr_streaming"+e.queryString},onHeartbeat:function(e){e.sendRaw("[]")},sendHeartbeat:function(e){e.sendRaw("[]")},onFinished:function(e,t){e.onClose(1006,"Connection interrupted ("+t+")",!1)}},Ve={getReceiveURL:function(e,t){return e.base+"/"+t+"/xhr"+e.queryString},onHeartbeat:function(){},sendHeartbeat:function(e){e.sendRaw("[]")},onFinished:function(e,t){200===t?e.reconnect():e.onClose(1006,"Connection interrupted ("+t+")",!1)}},Ye={getRequest:function(e){var t=new(v.getXHRAPI());return t.onreadystatechange=t.onprogress=function(){switch(t.readyState){case 3:t.responseText&&t.responseText.length>0&&e.onChunk(t.status,t.responseText);break;case 4:t.responseText&&t.responseText.length>0&&e.onChunk(t.status,t.responseText),e.emit("finished",t.status),e.close()}},t},abortRequest:function(e){e.onreadystatechange=null,e.abort()}},$e={createStreamingSocket:function(e){return this.createSocket(Qe,e)},createPollingSocket:function(e){return this.createSocket(Ve,e)},createSocket:function(e,t){return new Ge(e,t)},createXHR:function(e,t){return this.createRequest(Ye,e,t)},createRequest:function(e,t,n){return new Je(e,t,n)},createXDR:function(e,t){return this.createRequest(Fe,e,t)}},v={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:m,DependenciesReceivers:g,getDefaultStrategy:function(e,t,n){var r={};function o(Xt,pn,ln,fn,dn){var Jt=n(e,Xt,pn,ln,fn,dn);return r[Xt]=Jt,Jt}var i,s=Object.assign({},t,{hostNonTLS:e.wsHost+":"+e.wsPort,hostTLS:e.wsHost+":"+e.wssPort,httpPath:e.wsPath}),c=Object.assign({},s,{useTLS:!0}),p=Object.assign({},t,{hostNonTLS:e.httpHost+":"+e.httpPort,hostTLS:e.httpHost+":"+e.httpsPort,httpPath:e.httpPath}),y={loop:!0,timeout:15e3,timeoutLimit:6e4},_=new At({lives:2,minPingDelay:1e4,maxPingDelay:e.activityTimeout}),P=new At({lives:2,minPingDelay:1e4,maxPingDelay:e.activityTimeout}),x=o("ws","ws",3,s,_),ft=o("wss","ws",3,c,_),dt=o("sockjs","sockjs",1,p),$=o("xhr_streaming","xhr_streaming",1,p,P),Ht=o("xdr_streaming","xdr_streaming",1,p,P),qt=o("xhr_polling","xhr_polling",1,p),an=o("xdr_polling","xdr_polling",1,p),Bt=new F([x],y),un=new F([ft],y),hn=new F([dt],y),zt=new F([new V(Y($),$,Ht)],y),Ut=new F([new V(Y(qt),qt,an)],y),Ft=new F([new V(Y(zt),new at([zt,new et(Ut,{delay:4e3})]),Ut)],y),yt=new V(Y(Ft),Ft,hn);return i=new at(t.useTLS?[Bt,new et(yt,{delay:2e3})]:[Bt,new et(un,{delay:2e3}),new et(yt,{delay:5e3})]),new Be(new ze(new V(Y(x),i,yt)),r,{ttl:18e5,timeline:t.timeline,useTLS:t.useTLS})},Transports:me,transportConnectionInitializer:function(){var e=this;e.timeline.info(e.buildTimelineMessage({transport:e.name+(e.options.useTLS?"s":"")})),e.hooks.isInitialized()?e.changeState("initialized"):e.hooks.file?(e.changeState("initializing"),h.load(e.hooks.file,{useTLS:e.options.useTLS},function(t,n){e.hooks.isInitialized()?(e.changeState("initialized"),n(!0)):(t&&e.onError(t),e.onClose(),n(!1))})):e.onClose()},HTTPFactory:$e,TimelineTransport:ae,getXHRAPI:function(){return window.XMLHttpRequest},getWebSocketAPI:function(){return window.WebSocket||window.MozWebSocket},setup:function(e){var t=this;window.Pusher=e;var n=function(){t.onDocumentBody(e.ready)};window.JSON?n():h.load("json2",{},n)},getDocument:function(){return document},getProtocol:function(){return this.getDocument().location.protocol},getAuthorizers:function(){return{ajax:Wt,jsonp:ie}},onDocumentBody:function(e){var t=this;document.body?e():setTimeout(function(){t.onDocumentBody(e)},0)},createJSONPRequest:function(e,t){return new ce(e,t)},createScriptRequest:function(e){return new se(e)},getLocalStorage:function(){try{return window.localStorage}catch{return}},createXHR:function(){return this.getXHRAPI()?this.createXMLHttpRequest():this.createMicrosoftXHR()},createXMLHttpRequest:function(){return new(this.getXHRAPI())},createMicrosoftXHR:function(){return new ActiveXObject("Microsoft.XMLHTTP")},getNetwork:function(){return _e},createWebSocket:function(e){return new(this.getWebSocketAPI())(e)},createSocketRequest:function(e,t){if(this.isXHRSupported())return this.HTTPFactory.createXHR(e,t);if(this.isXDRSupported(0===t.indexOf("https:")))return this.HTTPFactory.createXDR(e,t);throw"Cross-origin HTTP requests are not supported"},isXHRSupported:function(){var e=this.getXHRAPI();return!!e&&void 0!==(new e).withCredentials},isXDRSupported:function(e){var t=e?"https:":"http:",n=this.getProtocol();return!!window.XDomainRequest&&n===t},addUnloadListener:function(e){void 0!==window.addEventListener?window.addEventListener("unload",e,!1):void 0!==window.attachEvent&&window.attachEvent("onunload",e)},removeUnloadListener:function(e){void 0!==window.addEventListener?window.removeEventListener("unload",e,!1):void 0!==window.detachEvent&&window.detachEvent("onunload",e)}};!function(e){e[e.ERROR=3]="ERROR",e[e.INFO=6]="INFO",e[e.DEBUG=7]="DEBUG"}(pt||(pt={}));var nt=pt,Ke=function(){function e(t,n,r){this.key=t,this.session=n,this.events=[],this.options=r||{},this.sent=0,this.uniqueID=0}return e.prototype.log=function(t,n){t<=this.options.level&&(this.events.push(L({},n,{timestamp:O_now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())},e.prototype.error=function(t){this.log(nt.ERROR,t)},e.prototype.info=function(t){this.log(nt.INFO,t)},e.prototype.debug=function(t){this.log(nt.DEBUG,t)},e.prototype.isEmpty=function(){return 0===this.events.length},e.prototype.send=function(t,n){var r=this,o=L({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],t(o,function(i,s){i||r.sent++,n&&n(i,s)}),!0},e.prototype.generateUniqueID=function(){return this.uniqueID++,this.uniqueID},e}(),Ze=function(){function e(t,n,r,o){this.name=t,this.priority=n,this.transport=r,this.options=o||{}}return e.prototype.isSupported=function(){return this.transport.isSupported({useTLS:this.options.useTLS})},e.prototype.connect=function(t,n){var r=this;if(!this.isSupported())return It(new j,n);if(this.priority<t)return It(new E,n);var o=!1,i=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),s=null,c=function(){i.unbind("initialized",c),i.connect()},p=function(){s=N.createHandshake(i,function(x){o=!0,P(),n(null,x)})},y=function(x){P(),n(x)},_=function(){var x;P(),x=Z(i),n(new R(x))},P=function(){i.unbind("initialized",c),i.unbind("open",p),i.unbind("error",y),i.unbind("closed",_)};return i.bind("initialized",c),i.bind("open",p),i.bind("error",y),i.bind("closed",_),i.initialize(),{abort:function(){o||(P(),s?s.close():i.close())},forceMinPriority:function(x){o||r.priority<x&&(s?s.close():i.close())}}},e}();function It(e,t){return O_defer(function(){t(e)}),{abort:function(){},forceMinPriority:function(){}}}var tn=v.Transports,en=function(e,t,n,r,o,i){var s,c=tn[n];if(!c)throw new D(n);return e.enabledTransports&&-1===bt(e.enabledTransports,t)||e.disabledTransports&&-1!==bt(e.disabledTransports,t)?s=nn:(o=Object.assign({ignoreNullOrigin:e.ignoreNullOrigin},o),s=new Ze(t,r,i?i.getAssistant(c):c,o)),s},nn={isSupported:function(){return!1},connect:function(e,t){var n=O_defer(function(){t(new j)});return{abort:function(){n.ensureAborted()},forceMinPriority:function(){}}}};function rn(e){return e.httpHost?e.httpHost:e.cluster?"sockjs-"+e.cluster+".pusher.com":l.httpHost}function on(e){return e.wsHost?e.wsHost:function Nt(e){return"ws-"+e+".pusher.com"}(e.cluster?e.cluster:l.cluster)}function sn(e){return"https:"===v.getProtocol()||!1!==e.forceTLS}function cn(e){return"enableStats"in e?e.enableStats:"disableStats"in e&&!e.disableStats}var Mt=function(){function e(t,n){var r,o,i=this;if(function(c){if(null==c)throw"You must pass your app key when you instantiate Pusher."}(t),!(n=n||{}).cluster&&!n.wsHost&&!n.httpHost){var s=u("javascriptQuickStart");T.warn("You should always specify a cluster when connecting. "+s)}"disableStats"in n&&T.warn("The disableStats option is deprecated in favor of enableStats"),this.key=t,this.config=(o={activityTimeout:(r=n).activityTimeout||l.activityTimeout,authEndpoint:r.authEndpoint||l.authEndpoint,authTransport:r.authTransport||l.authTransport,cluster:r.cluster||l.cluster,httpPath:r.httpPath||l.httpPath,httpPort:r.httpPort||l.httpPort,httpsPort:r.httpsPort||l.httpsPort,pongTimeout:r.pongTimeout||l.pongTimeout,statsHost:r.statsHost||l.stats_host,unavailableTimeout:r.unavailableTimeout||l.unavailableTimeout,wsPath:r.wsPath||l.wsPath,wsPort:r.wsPort||l.wsPort,wssPort:r.wssPort||l.wssPort,enableStats:cn(r),httpHost:rn(r),useTLS:sn(r),wsHost:on(r)},"auth"in r&&(o.auth=r.auth),"authorizer"in r&&(o.authorizer=r.authorizer),"disabledTransports"in r&&(o.disabledTransports=r.disabledTransports),"enabledTransports"in r&&(o.enabledTransports=r.enabledTransports),"ignoreNullOrigin"in r&&(o.ignoreNullOrigin=r.ignoreNullOrigin),"timelineParams"in r&&(o.timelineParams=r.timelineParams),"nacl"in r&&(o.nacl=r.nacl),o),this.channels=N.createChannels(),this.global_emitter=new z,this.sessionID=Math.floor(1e9*Math.random()),this.timeline=new Ke(this.key,this.sessionID,{cluster:this.config.cluster,features:e.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:nt.INFO,version:l.VERSION}),this.config.enableStats&&(this.timelineSender=N.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+v.TimelineTransport.name})),this.connection=N.createConnectionManager(this.key,{getStrategy:function(c){return v.getDefaultStrategy(i.config,c,en)},timeline:this.timeline,activityTimeout:this.config.activityTimeout,pongTimeout:this.config.pongTimeout,unavailableTimeout:this.config.unavailableTimeout,useTLS:!!this.config.useTLS}),this.connection.bind("connected",function(){i.subscribeAll(),i.timelineSender&&i.timelineSender.send(i.connection.isUsingTLS())}),this.connection.bind("message",function(c){var p=0===c.event.indexOf("pusher_internal:");if(c.channel){var y=i.channel(c.channel);y&&y.handleEvent(c)}p||i.global_emitter.emit(c.event,c.data)}),this.connection.bind("connecting",function(){i.channels.disconnect()}),this.connection.bind("disconnected",function(){i.channels.disconnect()}),this.connection.bind("error",function(c){T.warn(c)}),e.instances.push(this),this.timeline.info({instances:e.instances.length}),e.isReady&&this.connect()}return e.ready=function(){e.isReady=!0;for(var t=0,n=e.instances.length;t<n;t++)e.instances[t].connect()},e.getClientFeatures=function(){return mt(St({ws:v.Transports.ws},function(t){return t.isSupported({})}))},e.prototype.channel=function(t){return this.channels.find(t)},e.prototype.allChannels=function(){return this.channels.all()},e.prototype.connect=function(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var t=this.connection.isUsingTLS(),n=this.timelineSender;this.timelineSenderTimer=new ee(6e4,function(){n.send(t)})}},e.prototype.disconnect=function(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)},e.prototype.bind=function(t,n,r){return this.global_emitter.bind(t,n,r),this},e.prototype.unbind=function(t,n,r){return this.global_emitter.unbind(t,n,r),this},e.prototype.bind_global=function(t){return this.global_emitter.bind_global(t),this},e.prototype.unbind_global=function(t){return this.global_emitter.unbind_global(t),this},e.prototype.unbind_all=function(t){return this.global_emitter.unbind_all(),this},e.prototype.subscribeAll=function(){var t;for(t in this.channels.channels)this.channels.channels.hasOwnProperty(t)&&this.subscribe(t)},e.prototype.subscribe=function(t){var n=this.channels.add(t,this);return n.subscriptionPending&&n.subscriptionCancelled?n.reinstateSubscription():n.subscriptionPending||"connected"!==this.connection.state||n.subscribe(),n},e.prototype.unsubscribe=function(t){var n=this.channels.find(t);n&&n.subscriptionPending?n.cancelSubscription():(n=this.channels.remove(t))&&n.subscribed&&n.unsubscribe()},e.prototype.send_event=function(t,n,r){return this.connection.send_event(t,n,r)},e.prototype.shouldUseTLS=function(){return this.config.useTLS},e.instances=[],e.isReady=!1,e.logToConsole=!1,e.Runtime=v,e.ScriptReceivers=v.ScriptReceivers,e.DependenciesReceivers=v.DependenciesReceivers,e.auth_callbacks=v.auth_callbacks,e}(),lt=w.default=Mt;v.setup(Mt)}])});